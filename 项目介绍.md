# OptAgent 项目介绍

## 项目概述

**OptAgent** 是一个基于 **LangGraph** 架构的高级AI驱动的优化代理框架，专门用于解决数学优化问题。该项目结合了大语言模型（LLM）的能力与系统化的验证和修正机制，生成可靠的优化解决方案。

### 核心特点
- 🚀 **AI驱动的优化求解**：利用大语言模型理解和解决复杂的数学优化问题
- 🔄 **三阶段验证系统**：建模→验证→修正的闭环工作流程
- 📊 **多基准测试支持**：支持多种优化问题基准测试
- 🛠️ **模块化架构**：基于deer-flow框架的智能工作流编排

## AGENT解决的问题类型

OptAgent专门解决各类数学优化问题，包括但不限于：

### 1. 线性规划问题
- **生产优化**：如最大化利润问题（产品A利润10元，产品B利润15元，资源约束等）
- **资源分配**：有限资源的最优分配
- **成本最小化**：在满足约束条件下的成本优化

### 2. 整数规划问题
- **组合优化**：离散决策变量的优化
- **调度问题**：排班、生产调度等

### 3. 非线性规划问题
- **复杂约束优化**：包含非线性约束的优化问题

### 4. 多目标优化
- **多目标权衡**：同时优化多个目标函数

## 工作流程

OptAgent采用三节点工作流架构：

```
问题输入 → 建模器 → 验证器 → 修正器
              ↑         ↓         ↓
              └─────────┴─────────┘
              （修正循环）
```

### 1. 建模器节点 (Modeler Node)
**功能**：创建数学模型和Python实现代码
- 分析自然语言问题描述
- 生成数学公式化表示
- 生成可执行的Python代码（使用Gurobi、PuLP等优化库）

**代码文件**：`src/graph/main_nodes.py` 中的 `modeler_node` 函数

### 2. 验证器节点 (Verifier Node)
**功能**：全面验证解决方案
- 检查数学模型正确性
- 验证Python代码语法和逻辑
- 验证解决方案的可行性和最优性
- 提供详细的修正反馈

**代码文件**：`src/graph/main_nodes.py` 中的 `verifier_node` 函数

### 3. 修正器节点 (Corrector Node)
**功能**：基于验证反馈修正问题
- 修正模型公式化错误
- 修正代码实现问题
- 基于验证器洞察改进解决方案质量

**代码文件**：`src/graph/main_nodes.py` 中的 `corrector_node` 函数

### 4. 报告器节点 (Reporter Node)
**功能**：生成最终综合报告
- 总结优化问题和解决方案
- 提供数学分析和代码文档
- 格式化结果以便于理解

## 使用的工具和技术

### 核心框架
- **LangGraph**：多智能体工作流编排
- **LangChain**：LLM交互和工具集成
- **Deer-Flow**：高级多智能体工作流架构基础

### 优化求解器
- **Gurobi**：行业领先的商业优化求解器
- **PuLP**：开源的线性规划库
- **NumPy/Pandas**：数值计算和数据处理

### 大语言模型支持
- **DeepSeek**：默认配置的LLM提供商
- **OpenAI**：支持GPT系列模型
- **VolcEngine**：支持火山引擎模型
- **LiteLLM**：统一的LLM调用接口

### 监控和追踪
- **LangSmith**：智能体运行监控和性能分析
- **内置日志系统**：详细的执行追踪和调试信息

## 核心代码文件解析

### 1. 入口文件
- **`main.py`**：命令行入口点，支持交互式和命令行模式
- **`server.py`**：Web服务器入口，提供API接口

### 2. 工作流核心
- **`src/workflow.py`**：主要工作流入口，提供同步和异步接口
- **`src/graph/builder.py`**：构建OptAgent工作流状态图
- **`src/graph/main_nodes.py`**：包含三个核心节点实现
- **`src/graph/types.py`**：状态类型定义

### 3. 配置管理
- **`conf.yaml`**：主要配置文件（LLM API密钥、模型设置）
- **`src/config/agents.py`**：智能体配置和LLM管理
- **`src/config/timeout_config.py`**：超时配置系统
- **`.env`**：环境变量配置（LangSmith监控等）

### 4. 提示词管理
- **`src/prompts/`**：包含各智能体的提示词模板
  - `modeler.md`：建模专家提示词
  - `verifier.md`：验证器提示词
  - `corrector.md`：修正器提示词

### 5. 工具和工具
- **`src/tools/execution_evaluator.py`**：代码执行评估工具
- **`src/utils/`**：各种工具函数
  - `robust_code_extraction.py`：代码提取工具
  - `robust_optimal_value_extraction.py`：最优值提取工具

### 6. 评估系统
- **`src/eval/`**：基准测试评估系统
  - `evaluator.py`：主要评估器类
  - `result_extractor.py`：结果提取工具
  - `config.py`：评估配置

### 7. 基准测试数据
- **`benchmark/`**：包含多种优化问题基准测试数据集
  - `MAMO_ComplexLP.jsonl`：复杂线性规划问题
  - `NL4OPT.jsonl`：自然语言优化问题
  - `OptMATH_Bench.json`：数学优化基准

## 项目结构

```
OptAgent/
├── src/                    # 源代码目录
│   ├── agents/            # 智能体定义
│   ├── config/            # 配置管理
│   ├── graph/             # 工作流图定义
│   ├── prompts/           # 提示词模板
│   ├── tools/             # 工具定义
│   ├── utils/             # 工具函数
│   ├── eval/              # 评估系统
│   └── workflow.py        # 工作流入口
├── benchmark/             # 基准测试数据
├── examples/              # 使用示例
├── scripts/               # 脚本文件
├── conf.yaml              # 主配置文件
├── main.py                # 命令行入口
└── server.py              # Web服务器入口
```

## 运行方式

### 1. 命令行模式
```bash
python main.py "最大化利润：产品A利润10元，产品B利润15元，资源约束..."
```

### 2. 交互式模式
```bash
python main.py --interactive
```

### 3. Web服务器模式
```bash
python server.py
```

### 4. 基准测试模式
```bash
python scripts/run_eval.py
```

## 配置说明

### 1. LLM配置 (`conf.yaml`)
```yaml
BASIC_MODEL:
  base_url: https://api.deepseek.com
  model: "deepseek-chat"
  api_key: "your_api_key_here"
```

### 2. LangSmith监控配置 (`.env`)
```env
LANGSMITH_TRACING=true
LANGSMITH_API_KEY=your_langsmith_api_key
LANGSMITH_PROJECT=your_project_name
```

## 性能特点

### 1. 自动循环检测
防止无限修正循环，确保工作流终止

### 2. 可配置修正限制
控制最大重试次数，平衡精度和效率

### 3. 全面错误处理
鲁棒的错误检测和恢复机制

### 4. 状态持久化
使用LangGraph检查点机制恢复工作流

## 应用场景

### 1. 学术研究
- 数学优化算法研究
- AI在运筹学中的应用

### 2. 工业应用
- 生产计划优化
- 供应链管理
- 资源分配决策

### 3. 教育培训
- 优化问题教学工具
- 自动解题助手

## 技术优势

1. **智能化程度高**：利用LLM理解自然语言问题描述
2. **解决方案可靠**：通过多阶段验证确保结果正确性
3. **扩展性强**：模块化架构支持新问题类型和求解器
4. **用户友好**：支持自然语言交互和多种运行模式

## 总结

OptAgent代表了AI驱动的数学优化求解的前沿技术，将大语言模型的自然语言理解能力与传统优化算法相结合，为复杂优化问题提供了智能化的解决方案框架。项目具有强大的理论基础、完善的技术实现和广泛的应用前景。